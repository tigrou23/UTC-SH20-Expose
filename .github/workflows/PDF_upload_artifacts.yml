name: Upload PDF to GitHub artifacts
on:
  push:
    branches: [ test-ci ]
jobs:
  build-examples:
    runs-on: ubuntu-latest
    container:
      image: alpine:latest
    steps:
        - name: Checkout
          uses: actions/checkout@v2

        - name: Install dependencies
          run: apk update && apk add texmf-dist texlive texmf-dist-latexextra nodejs

        - name: Build
          run: cp -r latexPackage/utc-*/* rapport && cd rapport && pdflatex -interaction=nonstopmode -halt-on-error rapport.tex && cd ..

        - name: Create index.html
          run: mkdir public && echo "<!DOCTYPE html><html lang='fr'><head><meta charset='UTF-8'><meta http-equiv='refresh' content='5;url=../rapport/rapport.pdf'><title>Redirection vers le PDF</title></head></html>" > public/index.html && ls -l
            
        - name: Upload Artifact
          uses: actions/upload-artifact@v4
          with:
            name: rapport.pdf
            path: rapport/rapport.pdf

        - name: Move PDFs
          run: mv rapport/rapport.pdf public
          shell: bash
        - name: Move index page
          run: cp README.md public/index.md
          shell: bash
        - name: Deploy
          uses: peaceiris/actions-gh-pages@v3.8.0
          with:
            deploy_key: ${{ CICD_TOKEN }}
            publish_dir: public
            allow_empty_commit: true
            force_orphan: true
            enable_jekyll: true

            
